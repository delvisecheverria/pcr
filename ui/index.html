<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pulse Web UI</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Tema de highlight.js -->
  <link id="hljs-theme" rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" />
</head>
<body>
  <header>
    <h1>âš¡ Pulse Web UI</h1>
  </header>

  <!-- ğŸ”¹ Tabs Navigation -->
  <div class="tabs" style="display:flex; gap:10px; padding:10px; border-bottom:1px solid #ddd;">
    <button id="tab-recorder" class="tab active" style="padding:8px 16px; border-radius:6px; border:1px solid #007bff; background:#007bff; color:#fff; cursor:pointer;">
      ğŸ™ï¸ Recorder
    </button>
    <button id="tab-viewer" class="tab" style="padding:8px 16px; border-radius:6px; border:1px solid #ccc; background:#f8f8f8; color:#333; cursor:pointer;">
      ğŸ“„ YAML Viewer
    </button>
  </div>

  <main>
    <!-- ================= RECORDER PANEL ================= -->
    <section id="panel-recorder" class="tab-panel" style="display:block;">
      <!-- ğŸ› Toolbar -->
      <section class="toolbar">
        <button id="start" class="primary">â–¶ï¸ Start Recorder</button>
        <button id="stop" class="danger" disabled>ğŸ›‘ Stop Recorder</button>
        <button id="status" class="secondary">ğŸ“¡ Check Status</button>
      </section>

      <!-- ğŸŸ¢ Status -->
      <div id="status-bar">
        <span class="status-indicator" id="indicator"></span>
        <span id="status-text">Idle</span>
      </div>

      <!-- ğŸ“¡ Recorded Requests -->
      <section id="recorded-requests">
        <h2>ğŸ“‹ Recorded Requests</h2>
        <div class="requests-container">
          <div id="requests-list" class="requests-list"></div>

          <div id="request-detail" class="request-detail hidden">
            <div class="request-header">
              <div><strong>Protocol:</strong> <span id="req-protocol">-</span></div>
              <div><strong>Server:</strong> <span id="req-server">-</span></div>
              <div><strong>Port:</strong> <span id="req-port">-</span></div>
              <div><strong>Method:</strong> <span id="req-method">-</span></div>
              <div><strong>Path:</strong> <span id="req-path">-</span></div>
            </div>

            <div class="tabs">
              <button class="tab active" data-tab="headers">Headers</button>
              <button class="tab" data-tab="body">Body</button>
              <button class="tab" data-tab="response">Response</button>
              <button class="tab" data-tab="meta">Meta</button>
            </div>

            <pre class="tab-content" id="headers"></pre>
            <pre class="tab-content hidden" id="body"></pre>
            <pre class="tab-content hidden" id="response"></pre>
            <pre class="tab-content hidden" id="meta"></pre>
          </div>
        </div>
      </section>

      <!-- ğŸ§  Log Console -->
      <section id="logs">
        <h2>ğŸ§  Log Console</h2>
        <pre id="log">[--] Pulse UI initializing...\n</pre>
      </section>

      <!-- ğŸ’¾ Saved Recordings -->
      <section id="recordings">
        <h2>ğŸ’¾ Saved Recordings</h2>
        <button id="refresh-recordings" class="secondary">ğŸ”„ Refresh List</button>
        <ul id="recordings-list"></ul>
      </section>

      <!-- ğŸ§¾ YAML Preview Modal -->
      <div id="yaml-modal" class="modal hidden">
        <div class="modal-content">
          <button id="close-modal" class="close-btn">âœ–</button>
          <h3 id="yaml-title">YAML Preview</h3>
          <div class="modal-actions">
            <button id="download-yaml" class="download-btn">â¬‡ï¸ Download</button>
          </div>
          <pre id="yaml-content">Loading...</pre>
        </div>
      </div>
    </section>

    <!-- ================= YAML VIEWER PANEL ================= -->
    <section id="panel-viewer" class="tab-panel" style="display:none;">
      <iframe src="yaml-viewer.html" frameborder="0" style="width:100%; height:calc(100vh - 160px);"></iframe>
    </section>
  </main>

  <footer>
    âš¡ Pulse Load Testing â€” Built with Go &amp; Love ğŸ’š
    <label class="toggle">
      ğŸŒ <input type="checkbox" id="theme-toggle" /> ğŸŒ™
    </label>
  </footer>

  <!-- Scripts -->
  <script src="app.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>

  <script>
    // Tab switching logic
    const tabRecorder = document.getElementById('tab-recorder');
    const tabViewer = document.getElementById('tab-viewer');
    const panelRecorder = document.getElementById('panel-recorder');
    const panelViewer = document.getElementById('panel-viewer');

    function activateTab(tab) {
      if (tab === 'recorder') {
        tabRecorder.style.background = '#007bff';
        tabRecorder.style.color = '#fff';
        tabViewer.style.background = '#f8f8f8';
        tabViewer.style.color = '#333';
        panelRecorder.style.display = 'block';
        panelViewer.style.display = 'none';
      } else {
        tabViewer.style.background = '#007bff';
        tabViewer.style.color = '#fff';
        tabRecorder.style.background = '#f8f8f8';
        tabRecorder.style.color = '#333';
        panelRecorder.style.display = 'none';
        panelViewer.style.display = 'block';
      }
    }

    tabRecorder.onclick = () => activateTab('recorder');
    tabViewer.onclick = () => activateTab('viewer');

    // highlight.js theme sync
    hljs.configure({ ignoreUnescapedHTML: true });
    (function syncHljsTheme() {
      const themeLink = document.getElementById('hljs-theme');
      const toggle = document.getElementById('theme-toggle');
      function applyTheme(isDark) {
        themeLink.href = isDark
          ? 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css'
          : 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';
      }
      const isDark = localStorage.getItem('pulse-theme') === 'dark';
      toggle.checked = isDark;
      applyTheme(isDark);
      toggle.addEventListener('change', (e) => {
        applyTheme(e.target.checked);
        localStorage.setItem('pulse-theme', e.target.checked ? 'dark' : 'light');
      });
    })();
  </script>
</body>
</html>
